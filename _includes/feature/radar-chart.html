{% comment %}

    Embed a radar chart, https://www.chartjs.org/docs/latest/charts/radar.html
    
    E.G. --> {% include feature/radar-chart.html data="party_platforms_20th_century_all" years="1972,McGovern;1972,Nixon" topics="Cold War;free America;basic rights" %}

    Limit 6 years

    Options for data value:
        sotu_20th_century
        sotu_20th_century_1900_1944
        sotu_20th_century_1948_2000
        party_platforms_1900_1944_all
        party_platforms_1900_1944_democratic
        party_platforms_1900_1944_republican
        party_platforms_1948_2000_all
        party_platforms_1948_2000_democratic
        party_platforms_1948_2000_republican
        party_platforms_20th_century_all
        party_platforms_20th_century_democratic
        party_platforms_20th_century_republican

{% endcomment %}

{% capture topicdata %}{{ include.data | append: '_topics' }}{% endcapture %}
{% capture documentdata %}{{ include.data | append: '_documents' }}{% endcapture %}
{% capture varName %}topic_{{ include.topic | slugify | replace: "-","_" }}{% endcapture %}

{%- assign topics = include.topics | split: ";" -%}
{%- assign docs = include.years | split: ";" -%}
{%- assign chosendocuments = site.data.topics[documentdata] -%}
{%- assign chosentopics = site.data.topics[topicdata] -%}
{%- assign colors = site.data.config-theme-colors | where_exp: 'item', 'item.rgba' -%}

<canvas id="radarChart" class="py-5"></canvas>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.0/chart.min.js"></script>
<script>
const radctx = document.getElementById('radarChart');

let topicData = [
  {%- for d in docs -%}{%- assign docparts = d | split: ',' -%}{%- assign record = chosendocuments | where_exp: 'item', 'item.id contains docparts[0] and item.id contains docparts[1]' -%}
  [ {{ d | replace: ',', '-' | escape | jsonify }}, {% for r in record %}{{ r.id | replace: "-", " " | jsonify }}{% endfor %}, [{%- for t in topics -%}{%- assign selectedtopics = chosentopics | where: 'TopicName', t -%}{% for s in selectedtopics %}{%- for r in record -%}{{ r[s.Topic] }}{%- endfor -%}{%- endfor -%}{% unless forloop.last %}, {% endunless %}{%- endfor -%}] ]{% unless forloop.last %},{% endunless %}{%- endfor -%}
];

let colorData = [
  {% for c in colors %}[ {{ c.color_class | jsonify }}, {{ c.color | jsonify }}, {{ c.rgba |jsonify }}]{% unless forloop.last %},{% endunless %}{%- endfor -%}
];

let itemData = []
for (let i = 0; i < topicData.length; i++) itemData.push({
    label: topicData[i][1],
    data: topicData[i][2],
    fill: true,
    backgroundColor: 'rgba(' + colorData[i][2] + ', 0.2)',
    borderColor: 'rgb(' + colorData[i][2] + ')',
    pointBackgroundColor: 'rgb(' + colorData[i][2] + ')',
    pointBorderColor: colorData[i][1],
    pointHoverBackgroundColor: colorData[i][1],
    pointHoverBorderColor: 'rgb(' + colorData[i][2] + ')'
});

const data = {
  labels: [
    {%- for t in topics -%}
    {{ t | jsonify }}{% unless forloop.last %},{% endunless %}
    {%- endfor -%}
  ],
  datasets: itemData
};

const radarChart = new Chart(radctx, {
  type: 'radar',
  data: data,
  options: {
    elements: {
      line: {
        borderWidth: 3
      }
    }
  },
});
</script>